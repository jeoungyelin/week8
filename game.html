<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”„ë ˆì²¼ ë¨¹ê¸° ê²Œì„ (êµìˆ˜ë‹˜ ëª°ë˜ í”„ë ˆì²¼)</title>
    
    <style>
        /* A. ì „ì²´ ì´ˆê¸° ì„¤ì • ë° ì»¨í…Œì´ë„ˆ */
        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden;
            font-family: 'Do Hyeon', sans-serif;
            display: flex; justify-content: center; align-items: center;
        }

        #game-container {
            width: 100vw; /* ë·°í¬íŠ¸ ë„ˆë¹„ */
            height: 100vh; /* ë·°í¬íŠ¸ ë†’ì´ */
            position: relative;
        }

        #classroom-background {
            width: 100%; height: 100%;
            top: 0%; left: 0%;
            background-image: url('Frame 2087326990.png'); 
            
            background-size: 100% auto;
            background-repeat: no-repeat;
            
            background-position: center bottom -50px;
            position: absolute;
        }

        /* ------------------------------------- */
        /* B. ì¸ë¬¼ ë° ë™ì  ìš”ì†Œ ìŠ¤íƒ€ì¼ (ë³€ê²½ ì—†ìŒ) */
        /* ------------------------------------- */

        /* êµìˆ˜ë‹˜ ì˜ì—­ */
        #professor-area { 
            position: relative; 
            top: 10px;
            right: 450px;
            width: 100%; /* êµìˆ˜ë‹˜ê³¼ ë§í’ì„ ì´ ë“¤ì–´ê°ˆ ì˜ì—­ */
            height: 100%;
            z-index: ;
        }

        #surveillance-video {
            position: fixed;
            top: -128px;
            left: 234px;
            width: 75.5%; /* ë¶€ëª¨(#professor-area)ë¥¼ ê½‰ ì±„ì›ë‹ˆë‹¤. */
            height: 75.5%;
            object-fit: contain; /* ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì˜ì—­ ì±„ìš°ê¸° */
            z-index: 901; /* ğŸš¨ êµìˆ˜ë‹˜ ì´ë¯¸ì§€(z-index ê¸°ë³¸ê°’) ìœ„ì— ë°°ì¹˜í•©ë‹ˆë‹¤. ğŸš¨ */
        }        

        /* êµìˆ˜ë‹˜ ì´ë¯¸ì§€ */
        #professor-img {
            width: 60%; height: 60%;
            top: 0px;
            left: 370px;
            background-image: url('image 110497.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
            position: fixed;
            z-index: 898; /* ğŸš¨ ë¹„ë””ì˜¤ë³´ë‹¤ ë‚®ê²Œ ğŸš¨ */
        }
        /* í”Œë ˆì´ì–´ ì´ë¯¸ì§€ */
        #player-img {
            width: 400px; height: 480px;
            background-image: url('back student.png');
            background-size: contain;
            background-repeat: no-repeat;
            position: absolute;
            bottom: 40px; left: 37%;
            z-index: 903;
        }

        /* ë§í’ì„  ì´ë¯¸ì§€ (ê³µê²©) */
        #professor-bubble {
            width: 400px; height: 200px;
             left: 200px; top: 50px;
            background-size: contain;
            background-repeat: no-repeat;
            position: absolute;
            transform-origin: center;
            will-change: transform;
            z-index: 910;
        }

        .professor-bubble {
          transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .professor-bubble.bubble-hit {
          transform: scale(1.5) rotate(15deg);
          opacity: 0;
        }
        .player-hit {
          animation: shake 0.3s ease;
        }
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-10px); }
          75% { transform: translateX(10px); }
        }


        /* ------------------------------------- */
        /* ğŸš¨ D. ìŠ¤í…Œì´í„°ìŠ¤ ì°½ ê´€ë ¨ CSS (Flexbox ì¬ë°°ì¹˜ - ë³€ê²½ ì—†ìŒ) ğŸš¨ */
        /* ------------------------------------- */

        /* ğŸš¨ ìŠ¤í…Œì´í„°ìŠ¤ ë°” ì „ì²´ ì»¨í…Œì´ë„ˆ (Flexbox ê¸°ì¤€) */
        #status-bar-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 905;
            pointer-events: none;
            
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 25px;
            box-sizing: border-box;
        }

        /* í•˜ë‹¨ ë˜í¼ */
        #bottom-status-wrapper {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
        }
        
        /* 1. ì‹œê°„ ì°½ ì´ë¯¸ì§€ */
        #time-status-box {
            width: 300px; height: 160px;
            background-image: url('Group 2085666292.png'); 
            background-size: contain;
            background-repeat: no-repeat;
            position: relative;
        }

        /* ğŸš¨ D-0. íƒ€ì´ë¨¸ ë°”ì˜ ë¶€ëª¨ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ğŸš¨ */
        #status-timer {
            position: absolute; /* #time-status-boxë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ ì„¤ì • */
            width: 262px; /* íƒ€ì´ë¨¸ ë°”ê°€ ë“¤ì–´ê°ˆ ì˜ì—­ (ì‹œê°„ ì°½ í¬ê¸°ì— ë§ì¶° ì¡°ì •) */
            height: 40px;
            top: 66px; /* ì‹œê°„ ì°½ ì´ë¯¸ì§€ ë‚´ë¶€ì˜ ì‹œì‘ ìœ„ì¹˜ ì¡°ì • */
            left: 18px;
            overflow: hidden; /* íƒ€ì´ë¨¸ ë°”ê°€ ë„˜ì¹˜ëŠ” ê²ƒì„ ë°©ì§€ */
            /* z-index: 40; */ /* í•„ìš”ì— ë”°ë¼ z-index ì„¤ì • */
        }

        #timer-bar {
            position: absolute;
            width: 100%; /* ğŸš¨ ì‹œì‘ ì‹œ 100%ë¡œ ê°€ë“ ì°¨ê²Œ ì„¤ì • ğŸš¨ */
            height: 100%;
            top: 0; 
            left: 0; 
            
            border-radius: 5px; 
            box-sizing: border-box;
            
            background: linear-gradient(to right, 
                #FF00BB,     
                #FFCFF2     
            );
            
            transition: width 0.9s linear; /* ğŸš¨ JavaScriptë¡œ 90ì´ˆ ë™ì•ˆ ì¤„ì–´ë“œëŠ” ê³¼ì •ì„ ìì—°ìŠ¤ëŸ½ê²Œ ë§Œë“­ë‹ˆë‹¤. ğŸš¨ */
        }

        /* ğŸš¨ ìƒˆë¡œ ì¶”ê°€: í•˜ë‹¨ ì¢Œì¸¡ ìŠ¤í…Œì´í„°ìŠ¤ ê·¸ë£¹ì„ ìˆ˜í‰ìœ¼ë¡œ ë°°ì—´ */
        #left-status-group {
            display: flex;
            justify-content: flex-start; /* âœ… ìë™ ì •ë ¬ */
            align-items: flex-end;
            width: 100%;
        }

        /* 2. í”„ë ˆì²¼ íšë“ ì°½ */
        #pretzel-status-box {
            position: fixed;
            width: 400px; height: 160px;
            bottom: 40px; right: -145px;
            background-image: url('Group 2085666330 (1).png'); 
            background-size: contain;
            background-repeat: no-repeat;
            display: flex; align-items: center; justify-content: flex-end;
            padding-right: 10px;
            z-index: 998;
        }

        /* í”„ë ˆì²¼ ì•„ì´ì½˜ ë° ì¹´ìš´íŠ¸ */
        #pretzel-icon {
            width: 130px; height: 130px;
            background-image: url('kingzzang__htt-32.png'); 
            background-size: contain;
            background-repeat: no-repeat;
            position: absolute; left: 5px;
            top: 66%; transform: translateY(-50%);
        }
        #pretzel-count-display {
            font-size: 55px; color: #935300;
            font-weight: bold;

            text-shadow: 
                -5px -5px 3px #FFFFFF,  /* ì¢Œìƒë‹¨ */
                 5px -5px 3px #FFFFFF,  /* ìš°ìƒë‹¨ */
                -5px 5px 3px #FFFFFF,   /* ì¢Œí•˜ë‹¨ */
                 5px 5px 3px #FFFFFF,   /* ìš°í•˜ë‹¨ */

                 -2px 1px 15px rgba(0, 0, 0, 0.6); /* 5. ê·¸ë¦¼ì íš¨ê³¼ */

            position: fixed; right: 72px;
            bottom: 3%; transform: translateY(-50%);
            z-index: 10000;
        }

        /* 3. ê²½ê³  ì‹œìŠ¤í…œ */
        #warning-system {
            position: fixed;     /* âœ… ê³ ì • */
            bottom: 0;
            left: -15px;
            width: 100%;
            height: 240px;
            pointer-events: none; /* í´ë¦­ ë°©ì§€ */
            z-index: 9999;
        }

        /* ê²½ê³ ì°½ ì´ë¯¸ì§€ */
        #warning-message-box {
            width: 400px; height: 160px;
            background-image: url('Group 2085666290.png');
            background-size: contain;
            background-repeat: no-repeat;
            position: absolute; 
            bottom: 40px;
            left: 40px;
        }

        /* ê²½ê³  ì¹´ë“œ ì˜ì—­ */
        #warning-card-area {
            position: absolute;
            bottom: 50px;          /* ê²½ê³ ì°½ ë°”ë¡œ ìœ„ë¡œ ë„ì›€ */
            left: 54px;             /* í™”ë©´ ì™¼ìª½ ì—¬ë°± */
            display: flex;
            gap: 6px;
            align-items: center;
        }

        /* ê²½ê³  ì¹´ë“œ ì´ë¯¸ì§€ */
        .warning-card {
          position: relative;  
          width: 70px;
          height: 90px;
          bottom: 0;
          left: 0;
          opacity: 0;
          background-image: url('Group 2085666255.png');
          background-size: contain;
          background-repeat: no-repeat;
          transform: scale(0.8);
          transition: all 0.3s ease;
        }

        .warning-card.active {
            opacity: 1;
            transform: scale(1.1) rotate(-3deg);
        }


        /* ------------------------------------- */
        /* F. ì»¬ëŸ¬ ì˜¤ë²„ë ˆì´ ìŠ¤íƒ€ì¼ (ì‹œì•¼ê° íš¨ê³¼) */
        /* ------------------------------------- */

        #color-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            
            /* ì›í•˜ëŠ” ìƒ‰ìƒê³¼ íˆ¬ëª…ë„: ë³´ë¼ìƒ‰ 30% íˆ¬ëª… */
            background-color: rgba(189, 0, 198, 1); 

            mix-blend-mode: overlay;
            
            z-index: 904; 
            
            pointer-events: none; /* í´ë¦­ ì´ë²¤íŠ¸ í†µê³¼ */
        }

        /* ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
        .hidden { display: none !important; }
    </style>
</head>

    <body>
      <div id="game-container">
          
          <div id="classroom-background">
              
              <div id="professor-area">
                  <div id="professor-img"></div>
                  <div id="professor-bubble" class="hidden"></div>

                  <video id="surveillance-video" loop muted playsinline style="display: none;">
                      <source src="profes video.mp4" type="video/mp4">
                      Your browser does not support the video tag.
                  </video>
              </div>
              
              <div id="player-img"></div>
          <div id="color-overlay" class="hidden"></div>
          <div id="status-bar-container">
              
              <div id="time-status-box">
                  <div id="status-timer">
                      <div id="timer-bar"></div>
                  </div>  
              </div>  
              
              <div id="bottom-status-wrapper">
                  <div id="left-status-group">
                      <div id="pretzel-status-box">
                          <div id="pretzel-count-display"></div>
                          <div id="pretzel-icon"></div>
                      </div>
                  </div>
              </div>
          </div> 
      </div>

      <!-- ğŸš¨ ë…ë¦½ëœ ê²½ê³  ì‹œìŠ¤í…œ (ë‹¤ë¥¸ ë ˆì´ì•„ì›ƒì— ì˜í–¥ X) -->
      <div id="warning-system">
          <div id="warning-message-box"></div>
          <div id="warning-card-area">
              <div class="warning-card" id="card-1"></div>
              <div class="warning-card" id="card-2"></div>
              <div class="warning-card" id="card-3"></div>
          </div>
      </div>

        <audio id="click-sound" src="eat-323883.mp3"></audio>
        <audio id="game-bgm" src="main bgm.mp3" loop></audio>

        <audio id="surveillance-alert-sound" src="horror-orchestra-warning-338415.mp3"></audio>
        <audio id="pop-sound" src="ow-sound-38502.mp3"></audio>

    <script>
    // ğŸš¨ BGM ë° í´ë¦­ í•¨ìˆ˜ëŠ” DOMContentLoaded ì™¸ë¶€ ìœ ì§€ ğŸš¨
    let isBgmStarted = false;
    let surveillanceTimerId; 

    function startGameBGM() {
        const gameBgm = document.getElementById('game-bgm');
        if (!isBgmStarted && gameBgm) {
            gameBgm.volume = 0.5;
            gameBgm.play().then(() => {
                isBgmStarted = true;
                console.log("BGM ì¬ìƒ ì‹œì‘!");
            }).catch(e => {
                console.error("BGM ì¬ìƒ ì‹¤íŒ¨:", e);
            });
        }
    }

    function playClickSound() {
        const clickSound = document.getElementById('click-sound');
        if (clickSound) {
            clickSound.currentTime = 0;
            clickSound.volume = 1.0;
            clickSound.play().catch(e => console.error('ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e));
        }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        console.log("ê²Œì„ ë¡œì§ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ.");
        
        const gameBgm = document.getElementById('game-bgm');
        const player = document.getElementById('player-img');
        const professorBubble = document.getElementById('professor-bubble');
        const surveillanceMode = document.getElementById('surveillance-mode');
        
        const BUBBLE_IMAGES = [
            'wrong.png',
            'what.png',
            'bobo.png',
            'gae.png',
            'ram.png'
        ];
        
        let bubbleTimerId; 
        let isSurveilling = false;

        const pretzelCountDisplay = document.getElementById('pretzel-count-display');
        const warningCards = document.querySelectorAll('.warning-card');
        
        /* ğŸš¨ ê²Œì„ ì˜¤ë²„ ê³µí†µ ì²˜ë¦¬ í•¨ìˆ˜ ì¶”ê°€ */
        function triggerGameOver(reason) {
          console.log(`ğŸ’€ ê²Œì„ ì˜¤ë²„ ë°œìƒ: ${reason}`);
          const bgm = document.getElementById("game-bgm");
          if (bgm) bgm.pause();
          setTimeout(() => {
            window.location.href = "gameover.html"; // âœ… ê²Œì„ì˜¤ë²„ í˜ì´ì§€ë¡œ ì´ë™
          }, 800);
        }

        function giveWarning() {
          if (currentWarningCount < warningCards.length) {
            const warningSound = document.getElementById("warning-sound");
            if (warningSound) {
              warningSound.currentTime = 0;
              warningSound.volume = 1.0;
              warningSound.play().catch((e) => console.error("âš ï¸ ê²½ê³ ìŒ ì¬ìƒ ì‹¤íŒ¨:", e));
            }

            const card = warningCards[currentWarningCount];
            if (card) {
              card.classList.add("active");
              card.style.opacity = '1';
              card.style.transform = 'scale(1)';
            }

            currentWarningCount++;

            const warningBox = document.getElementById("warning-message-box");
            document.body.classList.add("warning-flash");
            if (warningBox) warningBox.classList.add("shake-warning");

            setTimeout(() => {
              document.body.classList.remove("warning-flash");
              if (warningBox) warningBox.classList.remove("shake-warning");
            }, 600);

            if (currentWarningCount === warningCards.length) {
              triggerGameOver("ê²½ê³  3íšŒ ëˆ„ì ");
            }
          }
        }

        const timerBar = document.getElementById('timer-bar');
        const totalTime = 90;
        let currentTime = totalTime;
        const updateInterval = 1000;
        
        let playerX = 37;
        const moveSpeed = 2;
        const minX = 0;
        const maxX = 70;
        
        let currentPretzelCount = 0;
        let currentWarningCount = 0;
        const WIN_GOAL = 30;

        const professorVideo = document.getElementById('surveillance-video');
        const colorOverlay = document.getElementById('color-overlay');
        const surveillanceAlertSound = document.getElementById('surveillance-alert-sound');

        let movementLocked = false;
        let savedMoveSpeed = moveSpeed;
        
        pretzelCountDisplay.textContent = currentPretzelCount;
        
        function scheduleNextSurveillance() {
            const baseDelay = 5000; 
            const randomDelay = Math.random() * 1000;
            const totalDelay = baseDelay + randomDelay;
            
            surveillanceTimerId = setTimeout(() => { 
                toggleSurveillanceMode(true);
            }, totalDelay);
            
            console.log(`ë‹¤ìŒ ê°ì‹œ ëª¨ë“œëŠ” ${Math.round(totalDelay / 1000)}ì´ˆ í›„ì— ì‹œì‘ë©ë‹ˆë‹¤.`);
        }
        
        // ğŸš¨ ëœë¤ ë§í’ì„  ìƒì„± + í”Œë ˆì´ì–´ ìª½ìœ¼ë¡œ ë‹¤ê°€ì˜¤ê¸° ì‹œìŠ¤í…œ ğŸš¨
        function scheduleNextBubbleThrow() {
          if (isSurveilling || checkGameWin()) return;

          const delay = Math.random() * 700 + 500;

          setTimeout(() => {
            const bubbleCount = Math.floor(Math.random() * 2) + 2;
            for (let i = 0; i < bubbleCount; i++) {
              setTimeout(() => {
                createFlyingBubble(true);
              }, i * 300);
            }
            scheduleNextBubbleThrow();
          }, delay);
        }

        // ğŸš¨ ìœ„ì—ì„œ ì•„ë˜ë¡œ ë–¨ì–´ì§€ëŠ” ë§í’ì„  ìƒì„± í•¨ìˆ˜ ğŸš¨
        function createFlyingBubble() {
          if (isSurveilling) return;

          const bubble = document.createElement("div");
          bubble.classList.add("professor-bubble");
          bubble.style.width = "240px";
          bubble.style.height = "130px";
          bubble.style.backgroundImage = `url('${
            BUBBLE_IMAGES[Math.floor(Math.random() * BUBBLE_IMAGES.length)]
          }')`;
          bubble.style.backgroundSize = "contain";
          bubble.style.backgroundRepeat = "no-repeat";
          bubble.style.position = "absolute";
          bubble.style.zIndex = 910;

          const container = document.getElementById("game-container");
          const containerRect = container.getBoundingClientRect();

          const startX = Math.random() * (containerRect.width - 200);
          const startY = -150;
          bubble.style.left = `${startX}px`;
          bubble.style.top = `${startY}px`;
          container.appendChild(bubble);

          const targetY = containerRect.height + 100 + Math.random() * 200;
          const dx = (Math.random() - 0.5) * 500;
          const dy = targetY - startY;

          const duration = Math.random() * 6000 + 3000;

          bubble.animate(
            [
              { transform: "translate(0, 0)", opacity: 1 },
              { transform: `translate(${dx}px, ${dy}px) scale(0.8)`, opacity: 0.9 }
            ],
            { duration: duration, easing: "linear", fill: "forwards" }
          );

          const collisionCheck = setInterval(() => {
            const p = player.getBoundingClientRect();
            const b = bubble.getBoundingClientRect();

            const horizontalOverlap = b.left < p.right - 150 && b.right > p.left + 150;
            const verticalOverlap = b.bottom > p.top + 150 && b.top < p.bottom - 150;
            const overlap = horizontalOverlap && verticalOverlap;

            if (overlap) {
              console.warn("ğŸ’¥ ì¶©ëŒ ë°œìƒ!");
              giveWarning();

              const popSound = document.getElementById("pop-sound");
              if (popSound) {
                  popSound.currentTime = 0;
                  popSound.volume = 0.9;
                  popSound.play().catch(e => console.error("íŒ¡ ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:", e));
                }
                
                bubble.style.transition = "transform 0.3s ease, opacity 0.3s ease";
                bubble.style.transform = "scale(1.6) rotate(20deg)";
                bubble.style.opacity = "0";

                player.classList.add("player-hit");
                setTimeout(() => player.classList.remove("player-hit"), 300);

                setTimeout(() => bubble.remove(), 300);
                clearInterval(collisionCheck);
              }
            }, 50);

          setTimeout(() => {
            clearInterval(collisionCheck);
            bubble.remove();
          }, duration + 200);
        }
        
        function throwBubble() {
            if (isSurveilling || movementLocked || checkGameWin()) {
                scheduleNextBubbleThrow();
                return; 
            }
            
            professorBubble.classList.remove('hidden');
            const randomIndex = Math.floor(Math.random() * BUBBLE_IMAGES.length);
            professorBubble.style.backgroundImage = `url('${BUBBLE_IMAGES[randomIndex]}')`;

            professorBubble.style.animation = 'none';
            professorBubble.style.removeProperty('transform');
            void professorBubble.offsetWidth; 
            
            professorBubble.classList.add('bubble-throwing');
            console.log(`êµìˆ˜ë‹˜ì´ ë§í’ì„ (${BUBBLE_IMAGES[randomIndex]})ì„ ë˜ì¡ŒìŠµë‹ˆë‹¤!`);
        }

        function toggleSurveillanceMode(isStarting) {
            const duration = 4000;

            if (isStarting) {
                isSurveilling = true;
                document.querySelectorAll('.professor-bubble').forEach(b => b.remove());
                clearTimeout(bubbleTimerId);
                movementLocked = true;
                
                if (professorVideo) {
                    professorVideo.style.display = 'block';
                    professorVideo.currentTime = 0;
                    professorVideo.play().catch(e => console.error("ë¹„ë””ì˜¤ ì¬ìƒ ì˜¤ë¥˜:", e));
                }

                if (colorOverlay) colorOverlay.classList.remove('hidden');
                if (surveillanceAlertSound) {
                    surveillanceAlertSound.currentTime = 0;
                    surveillanceAlertSound.volume = 1.0;
                    surveillanceAlertSound.play().catch(e => console.error("íš¨ê³¼ìŒ ì¬ìƒ ì˜¤ë¥˜:", e));
                }
                
                setTimeout(() => toggleSurveillanceMode(false), duration);

            } else {
                isSurveilling = false;
                if (professorVideo) {
                    professorVideo.pause();
                    professorVideo.style.display = 'none';
                }
                if (colorOverlay) colorOverlay.classList.add('hidden');

                setTimeout(() => {
                    movementLocked = false; 
                    console.log("ê°ì‹œ ëª¨ë“œ ì¢…ë£Œ. ì…ë ¥ í™œì„±í™”.");
                    scheduleNextSurveillance(); 
                    scheduleNextBubbleThrow(); 
                }, 500);
            }
        }
        
        scheduleNextSurveillance(); 
        scheduleNextBubbleThrow(); 
        
        document.addEventListener('keydown', (event) => {
            startGameBGM(); 
            
            if (movementLocked || isSurveilling) {
                console.log("ğŸš¨ ê°ì‹œ ì¤‘ ì´ë™ ê°ì§€! ê²Œì„ ì˜¤ë²„!");
                triggerGameOver("ê°ì‹œ ì¤‘ ì´ë™");
                event.preventDefault(); 
                return;
            }
            
            let isMoved = false;

            if (event.key === 'ArrowLeft') {
                playerX -= moveSpeed;
                isMoved = true;
            } else if (event.key === 'ArrowRight') {
                playerX += moveSpeed;
                isMoved = true;
            }

            if (isMoved) {
                if (playerX < minX) playerX = minX;
                else if (playerX > maxX) playerX = maxX;
                player.style.left = playerX + '%';
            }
        });

        /* âœ… í•´í”¼ì—”ë”© ì´ë™ ì¡°ê±´ ì¶”ê°€ */
        function checkGameWin() {
            if (currentPretzelCount >= WIN_GOAL) {
                console.log("ğŸ‰ í”„ë ˆì²¼ 30ê°œ ë‹¬ì„±! í•´í”¼ì—”ë”©ìœ¼ë¡œ ì´ë™!");
                clearInterval(timerInterval);
                clearTimeout(surveillanceTimerId);
                clearTimeout(bubbleTimerId);
                player.removeEventListener('click', playerClickHandler);

                // âœ… í•´í”¼ì—”ë”© í˜ì´ì§€ë¡œ ì´ë™
                setTimeout(() => {
                    window.location.href = "happyending.html";
                }, 800);

                return true;
            }
            return false;
        }

        function collectPretzel() {
            if (checkGameWin()) return;
            currentPretzelCount++;
            pretzelCountDisplay.textContent = currentPretzelCount;
            playClickSound();
            console.log(`í”„ë ˆì²¼ íšë“! í˜„ì¬ ê°œìˆ˜: ${currentPretzelCount}`);
            checkGameWin();
        }

        const playerClickHandler = () => {
            startGameBGM(); 
            if (movementLocked) {
                console.log("í´ë¦­ ì ê¸ˆë¨: ê°ì‹œ ëª¨ë“œ ì¤‘ì…ë‹ˆë‹¤.");
                return;
            }
            collectPretzel();
        };

        if (player) { 
            player.addEventListener('click', playerClickHandler);
        } else {
             console.error("í”Œë ˆì´ì–´ ìš”ì†Œ(id='player-img')ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì–´ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²° ì‹¤íŒ¨.");
        }

        function updateTimerBar() {
            if (!timerBar) {
                console.error("íƒ€ì´ë¨¸ ë°” ìš”ì†Œ(id='timer-bar')ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                clearInterval(timerInterval);
                return;
            }

            if (currentTime > 0) {
                currentTime--;
                const widthPercentage = (currentTime / totalTime) * 100;
                timerBar.style.width = widthPercentage + '%';
            } else {
                clearInterval(timerInterval); 
                if (currentPretzelCount < WIN_GOAL) {
                  triggerGameOver("ì‹œê°„ ì´ˆê³¼ - ëª©í‘œ ë¯¸ë‹¬");
                }
            }
        }

        const timerInterval = setInterval(updateTimerBar, updateInterval); 
    });
</script>
</body>
</html>